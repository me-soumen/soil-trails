<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home | Soil Trails</title>
    <link rel="icon" href="./images/misc/logo.png" type="image/png"/>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"/>
    <base href="./">
</head>
<body class="body-container">
<!-- Header -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark py-2 fixed-top">
    <div class="container">
        <!-- Logo -->
        <a class="navbar-brand d-flex align-items-center" href="./index.html" id="site-home-a">
            <img src="./images/common/site-logo.png" alt="Soil Trails" width="60" height="60" class="me-2">
            <div class="fw-bold title-text pt-2" style="font-family: 'Poppins', sans-serif;color: rgb(208 204 194)">
                <span class="fs-1">Soil Trails</span>
            </div>
        </a>

        <!-- Toggler for Mobile -->
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Nav Items -->
        <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav ms-auto align-items-center">
                <li class="nav-item">
                    <button class="btn btn-success btn-lg d-flex align-items-center justify-content-center">
                        <a href="add-sample" class="add-page-link">
                            <div class="pe-2 fs-4 fw-bold">+</div>
                            <div class="pe-1 fs-4 fw-bold">Add Sample</div>
                        </a>
                    </button>
                </li>
            </ul>
        </div>
    </div>
</nav>

<!-- Main Body -->
<div class="container pt-6">
    <div class="carousel-wrapper">
        <button class="arrow left" onclick="moveCarousel(-1)">
            <i class="bi bi-caret-left-fill"></i>
        </button>
        <section class="carousel" id="state-carousel">
            <!-- Dynamic State Tiles -->
        </section>
        <button class="arrow right" onclick="moveCarousel(1)">
            <i class="bi bi-caret-right-fill"></i>
        </button>
    </div>
    <section class="samples" id="sample-section">
        <!-- Dynamic Sample Tiles -->
    </section>

    <!-- Password Modal -->
    <div class="modal fade" id="delete-modal" tabindex="-1" aria-labelledby="delete-modal-label" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title fs-5" id="delete-modal-label">Want to delete this Sample?</h3>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <input type="password" class="form-control" id="password" placeholder="Enter Password"
                                   autocomplete="off">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary w-50" id="confirm-delete-btn"
                            onclick="handleConfirmDelete()">Confirm
                    </button>
                    <button class="btn btn-primary w-50" type="button" id="confirm-delete-pending-btn" disabled hidden>
                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                        Deleting...
                    </button>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Footer -->
<footer class="bg-dark text-light pt-5 pb-4">
    <div class="container text-center text-md-left">
        <div class="row text-center text-md-left">
            <!-- About -->
            <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mt-3">
                <h5 class="text-uppercase mb-4 font-weight-bold text-warning">Soil Trails</h5>
                <p>Documenting soil samples from various places across India with location, date, time, and notes.
                    A personal hobby and educational project!</p>
            </div>
            <!-- Contact -->
            <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mt-3">
                <h5 class="text-uppercase mb-4 font-weight-bold text-warning">Contact</h5>
                <p><i class="bi bi-house-fill me-2"></i> Bangalore, Karnataka, India</p>
                <p><i class="bi bi-envelope-fill me-2"></i> <a href="mailto:amra4murti@gmail.com" class="contact-link">amra4murti@gmail.com</a>
                </p>
                <p><i class="bi bi-phone-fill me-2"></i> <a href="tel:+919564072741" class="contact-link"> +91 95640
                    72741</a>
                </p>
            </div>
            <!-- Social -->
            <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mt-3">
                <h5 class="text-uppercase mb-4 font-weight-bold text-warning">Follow us</h5>
                <a href="https://www.youtube.com/@SantiCruClips" target="_blank" class="text-light ms-1 me-4 fs-4"><i
                        class="bi bi-youtube"></i></a>
                <a href="https://www.instagram.com/_santi_cru_/" target="_blank" class="text-light me-4 fs-4"><i
                        class="bi bi-instagram"></i></a>
                <a href="https://www.facebook.com/profile.php?id=100091524044969&mibextid=ZbWKwL" target="_blank"
                   class="text-light fs-4"><i class="bi bi-facebook"></i></a>
            </div>
        </div>
        <!-- Copyright -->
        <div class="row mt-3">
            <div class="col-md-12 text-center">
                <p class="text-light">Copyright Â© 2025 <a href="https://trails.click" target="_blank" class="copyright">Trails Projects.</a> All rights reserved.</p>
            </div>
        </div>
    </div>
</footer>

<!-- Alert Toast -->
<div class="toast" id="errorToast" style="position: fixed; top: 40px; right: 20px; z-index: 9999;" data-delay="3000">
    <div class="toast-header bg-danger text-white">
        <strong class="mr-auto">Error</strong>
    </div>
    <div class="toast-body" id="toastMessage">
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
        crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="./js/index.js" type="module"></script>
<script>
    const deleteModal = document.getElementById('delete-modal');
    const passwordInput = document.getElementById('password');
    const confirmBtn = document.getElementById('confirm-delete-btn');
    let currentSample = {};

    // Delete button listener - Open Modal
    if (deleteModal) {
        deleteModal.addEventListener('show.bs.modal', event => {
            const button = event.relatedTarget;
            const sampleId = button.getAttribute('data-id');
            const stateCode = button.getAttribute('data-code');
            currentSample = { sampleId, stateCode };

            const modalTitle = deleteModal.querySelector('.modal-title');
            modalTitle.textContent = `Want to delete the Sample: ${stateCode}${sampleId}?`;

            passwordInput.value = '';
            passwordInput.classList.remove('is-invalid');
            setTimeout(() => passwordInput.focus(), 200);
        });
    }

    // Confirm Delete button listener
    async function handleConfirmDelete() {
        const password = passwordInput.value.trim();
        const modalInstance = bootstrap.Modal.getInstance(deleteModal);
        const confirmBtn = document.getElementById('confirm-delete-btn');
        const pendingBtn = document.getElementById('confirm-delete-pending-btn');

        if (!password) {
            passwordInput.classList.add('is-invalid');
            return;
        }

        // Show loading spinner
        confirmBtn.hidden = true;
        pendingBtn.hidden = false;
        try {
            await deleteSample(currentSample.stateCode, currentSample.sampleId, password);
            showAlertToast("Sample deleted successfully!", "success");
            modalInstance.hide();
        } catch (error) {
            console.error('ERROR:', error);
            const message = error?.message || error?.toString() || "An unexpected error occurred.";
            showAlertToast(`ERROR :: ${message}`, "error");
            modalInstance.hide();
        } finally {
            // Hide spinner
            confirmBtn.hidden = false;
            pendingBtn.hidden = true;
        }
    }

    // Enter key listener on delete modal
    passwordInput.addEventListener('keydown', function (e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            handleConfirmDelete();
        }
    });
</script>
</body>
</html>